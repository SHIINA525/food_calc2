<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>フード量計算（犬・猫）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: "Hiragino Sans", "Yu Gothic", -apple-system,
                   BlinkMacSystemFont, system-ui, sans-serif;
      padding: 16px;
      max-width: 520px;
      margin: 0 auto;
      line-height: 1.6;
      background: #f5f5f5;
      font-size: 17px;
    }
    h1 {
      font-size: 22px;
      margin-bottom: 8px;
      text-align: center;
    }
    h2 {
      font-size: 19px;
      margin-top: 16px;
      margin-bottom: 8px;
    }
    h3 {
      font-size: 17px;
      margin-top: 14px;
      margin-bottom: 6px;
    }
    .card {
      background: #fff;
      border-radius: 10px;
      padding: 14px 14px 16px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.06);
      margin-top: 12px;
    }
    label {
      font-size: 15px;
      display: block;
      margin-bottom: 4px;
    }
    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 15px;
      box-sizing: border-box;
      background: #fff;
    }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      background: #1976d2;
      color: #fff;
    }
    button.secondary {
      background: #eee;
      color: #333;
    }
    button:disabled {
      opacity: 0.5;
      cursor: default;
    }
    .row {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-top: 8px;
    }
    .row > * {
      flex: 1;
    }
    .small {
      font-size: 13px;
      color: #666;
    }
    .pill-buttons {
      display: inline-flex;
      background: #e0e0e0;
      border-radius: 999px;
      padding: 2px;
      margin: 8px 0 12px;
    }
    .pill-button {
      border-radius: 999px;
      padding: 6px 16px;
      font-size: 14px;
      border: none;
      background: transparent;
      cursor: pointer;
    }
    .pill-button.active {
      background: #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.15);
    }
    .tab-page {
      display: none;
    }
    .tab-page.active {
      display: block;
    }
    .pet-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }
    .pet-chip {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #ccc;
      background: #fff;
      font-size: 14px;
      cursor: pointer;
    }
    .pet-chip.active {
      background: #1976d2;
      color: #fff;
      border-color: #1976d2;
    }
    .divider {
      height: 1px;
      background: #e0e0e0;
      margin: 12px 0;
    }
    .result-box {
      background: #fafafa;
      border-radius: 8px;
      padding: 8px 10px;
      margin-top: 10px;
      font-size: 15px;
    }
    .result-highlight {
      color: #e60033;
      font-weight: 600;
    }
    .svg-wrap {
      margin-top: 8px;
      border-radius: 8px;
      background: #fafafa;
      padding: 4px;
    }
    svg {
      width: 100%;
      height: 150px;
    }
  </style>
</head>
<body>
  <h1>フード量計算</h1>

  <div style="text-align:center;">
    <div class="pill-buttons">
      <button id="tabDogBtn" class="pill-button active">犬の計算</button>
      <button id="tabCatBtn" class="pill-button">猫の計算</button>
    </div>
  </div>

  <!-- 犬タブ -->
  <div id="dogPage" class="tab-page active">
    <div class="card">
      <h2>犬の情報</h2>

      <h3>犬の一覧</h3>
      <div id="dogList" class="pet-list"></div>

      <div class="divider"></div>

      <h3>犬を追加</h3>
      <label>名前</label>
      <input type="text" id="dogNameInput" placeholder="例）てつろう">
      <button id="addDogBtn" style="margin-top:8px;">犬を登録する</button>
      <p class="small">※ 登録後、一覧の名前をタップするとその子の画面が開きます。</p>
    </div>

    <div class="card" id="dogDetailCard" style="display:none;">
      <h2 id="dogTitle">選択中の犬</h2>

      <label>最新の体重（kg）を記録</label>
      <div class="row">
        <input type="number" id="dogWeightInput" step="0.01" placeholder="例）12.3">
        <button id="dogAddWeightBtn">体重を追加</button>
      </div>
      <p class="small" id="dogLatestWeightText">最新の体重: -</p>

      <label style="margin-top:12px;">活動レベル（係数）</label>
      <select id="dogActivitySelect">
        <option value="neutered">避妊・去勢している成犬</option>
        <option value="intact">避妊・去勢していない成犬</option>
        <option value="diet">減量</option>
        <option value="senior">高齢犬</option>
      </select>
      <p class="small" id="dogActivityInfo">現在の係数: 1.6</p>

      <label style="margin-top:12px;">1日の食事回数</label>
      <select id="dogMealsSelect">
        <option value="1">1回</option>
        <option value="2" selected>2回（おすすめ）</option>
        <option value="3">3回</option>
        <option value="4">4回</option>
      </select>

      <label style="margin-top:12px;">フード 100g あたりのカロリー（kcal）</label>
      <input type="number" id="dogFoodKcalInput" placeholder="例）350">

      <button id="dogCalcBtn" style="margin-top:12px;">フード量を計算する</button>

      <div class="result-box" id="dogResultBox" style="display:none;">
        <div>RER（基礎エネルギー）: <span id="dogRerSpan"></span> kcal</div>
        <div>DER（1日の必要エネルギー）: <span id="dogDerSpan"></span> kcal</div>
        <div>1日の給餌量: <span id="dogDailyGram" class="result-highlight"></span> g</div>
        <div>1回あたりの給餌量: <span id="dogPerMealGram" class="result-highlight"></span> g</div>
      </div>

      <h3 style="margin-top:16px;">体重の推移</h3>
      <p class="small" id="dogNoWeightMsg">まだ体重が記録されていません。</p>
      <ul class="small" id="dogWeightList" style="margin-top:4px; padding-left:18px;"></ul>

      <div class="svg-wrap" id="dogChartWrap" style="display:none;">
        <svg id="dogChart"></svg>
      </div>
    </div>
  </div>

  <!-- 猫タブ -->
  <div id="catPage" class="tab-page">
    <div class="card">
      <h2>猫の情報</h2>

      <h3>猫の一覧</h3>
      <div id="catList" class="pet-list"></div>

      <div class="divider"></div>

      <h3>猫を追加</h3>
      <label>名前</label>
      <input type="text" id="catNameInput" placeholder="例）ひまわり">
      <button id="addCatBtn" style="margin-top:8px;">猫を登録する</button>
      <p class="small">※ 登録後、一覧の名前をタップするとその子の画面が開きます。</p>
    </div>

    <div class="card" id="catDetailCard" style="display:none;">
      <h2 id="catTitle">選択中の猫</h2>

      <label>最新の体重（kg）を記録</label>
      <div class="row">
        <input type="number" id="catWeightInput" step="0.01" placeholder="例）4.2">
        <button id="catAddWeightBtn">体重を追加</button>
      </div>
      <p class="small" id="catLatestWeightText">最新の体重: -</p>

      <label style="margin-top:12px;">活動レベル（係数）</label>
      <select id="catActivitySelect">
        <option value="neutered">避妊・去勢している成猫</option>
        <option value="intact">避妊・去勢していない成猫</option>
        <option value="diet">減量</option>
        <option value="senior">高齢猫</option>
      </select>
      <p class="small" id="catActivityInfo">現在の係数: 1.2</p>

      <label style="margin-top:12px;">1日の食事回数</label>
      <select id="catMealsSelect">
        <option value="1">1回</option>
        <option value="2" selected>2回（おすすめ）</option>
        <option value="3">3回</option>
        <option value="4">4回</option>
      </select>

      <label style="margin-top:12px;">フード 100g あたりのカロリー（kcal）</label>
      <input type="number" id="catFoodKcalInput" placeholder="例）380">

      <button id="catCalcBtn" style="margin-top:12px;">フード量を計算する</button>

      <div class="result-box" id="catResultBox" style="display:none;">
        <div>RER（基礎エネルギー）: <span id="catRerSpan"></span> kcal</div>
        <div>DER（1日の必要エネルギー）: <span id="catDerSpan"></span> kcal</div>
        <div>1日の給餌量: <span id="catDailyGram" class="result-highlight"></span> g</div>
        <div>1回あたりの給餌量: <span id="catPerMealGram" class="result-highlight"></span> g</div>
      </div>

      <h3 style="margin-top:16px;">体重の推移</h3>
      <p class="small" id="catNoWeightMsg">まだ体重が記録されていません。</p>
      <ul class="small" id="catWeightList" style="margin-top:4px; padding-left:18px;"></ul>

      <div class="svg-wrap" id="catChartWrap" style="display:none;">
        <svg id="catChart"></svg>
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "food_calc_pets_v2";

    // pets = [{id,name,species,activity,meals,kcal,weights:[{date,weight}]}]
    let pets = loadPets();

    function loadPets() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        const data = raw ? JSON.parse(raw) : [];
        return Array.isArray(data) ? data : [];
      } catch {
        return [];
      }
    }
    function savePets() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(pets));
    }
    function generateId() {
      return "p_" + Math.random().toString(36).slice(2, 9);
    }
    function getPetsBySpecies(s) {
      return pets.filter(p => p.species === s);
    }
    function getPetById(id) {
      return pets.find(p => p.id === id) || null;
    }
    function getToday() {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${y}-${m}-${day}`;
    }
    function latestWeight(pet) {
      if (!pet.weights || pet.weights.length === 0) return null;
      return pet.weights[pet.weights.length - 1];
    }
    function roundInt(v) {
      return Math.round(v);
    }
    function formatDate(d) {
      return d.replace(/-/g, "/");
    }

    const ACTIVITY = {
      dog: { neutered: 1.6, intact: 1.8, diet: 1.0, senior: 1.4 },
      cat: { neutered: 1.2, intact: 1.4, diet: 0.8, senior: 1.1 }
    };
    function getK(species, key) {
      return ACTIVITY[species]?.[key] ?? 1.0;
    }

    // タブ切り替え
    const tabDogBtn = document.getElementById("tabDogBtn");
    const tabCatBtn = document.getElementById("tabCatBtn");
    const dogPage = document.getElementById("dogPage");
    const catPage = document.getElementById("catPage");

    tabDogBtn.onclick = () => {
      tabDogBtn.classList.add("active");
      tabCatBtn.classList.remove("active");
      dogPage.classList.add("active");
      catPage.classList.remove("active");
    };
    tabCatBtn.onclick = () => {
      tabCatBtn.classList.add("active");
      tabDogBtn.classList.remove("active");
      catPage.classList.add("active");
      dogPage.classList.remove("active");
    };

    // ---- 犬 ----
    const dogListEl = document.getElementById("dogList");
    const dogNameInput = document.getElementById("dogNameInput");
    const addDogBtn = document.getElementById("addDogBtn");
    const dogDetailCard = document.getElementById("dogDetailCard");
    const dogTitle = document.getElementById("dogTitle");
    const dogWeightInput = document.getElementById("dogWeightInput");
    const dogAddWeightBtn = document.getElementById("dogAddWeightBtn");
    const dogLatestWeightText = document.getElementById("dogLatestWeightText");
    const dogActivitySelect = document.getElementById("dogActivitySelect");
    const dogActivityInfo = document.getElementById("dogActivityInfo");
    const dogMealsSelect = document.getElementById("dogMealsSelect");
    const dogFoodKcalInput = document.getElementById("dogFoodKcalInput");
    const dogCalcBtn = document.getElementById("dogCalcBtn");
    const dogResultBox = document.getElementById("dogResultBox");
    const dogRerSpan = document.getElementById("dogRerSpan");
    const dogDerSpan = document.getElementById("dogDerSpan");
    const dogDailyGramSpan = document.getElementById("dogDailyGram");
    const dogPerMealGramSpan = document.getElementById("dogPerMealGram");
    const dogNoWeightMsg = document.getElementById("dogNoWeightMsg");
    const dogWeightList = document.getElementById("dogWeightList");
    const dogChartWrap = document.getElementById("dogChartWrap");
    const dogChart = document.getElementById("dogChart");

    let currentDogId = null;

    function renderDogList() {
      const dogs = getPetsBySpecies("dog");
      dogListEl.innerHTML = "";
      if (dogs.length === 0) {
        const span = document.createElement("span");
        span.className = "small";
        span.textContent = "まだ登録されていません。";
        dogListEl.appendChild(span);
        dogDetailCard.style.display = "none";
        return;
      }
      dogs.forEach(p => {
        const b = document.createElement("button");
        b.type = "button";
        b.className = "pet-chip" + (p.id === currentDogId ? " active" : "");
        b.textContent = p.name;
        b.onclick = () => {
          currentDogId = p.id;
          renderDogList();
          showDog();
        };
        dogListEl.appendChild(b);
      });
    }

    addDogBtn.onclick = () => {
      const name = dogNameInput.value.trim();
      if (!name) { alert("名前を入力してください。"); return; }
      const pet = {
        id: generateId(),
        name,
        species: "dog",
        activity: "neutered",
        meals: 2,
        kcal: null,
        weights: []
      };
      pets.push(pet);
      savePets();
      dogNameInput.value = "";
      currentDogId = pet.id;
      renderDogList();
      showDog();
    };

    dogAddWeightBtn.onclick = () => {
      const pet = getPetById(currentDogId);
      if (!pet) return;
      const w = parseFloat(dogWeightInput.value);
      if (!w || w <= 0) { alert("体重を正しく入力してください。"); return; }
      pet.weights.push({ date: getToday(), weight: w });
      savePets();
      dogWeightInput.value = "";
      showDog();
    };

    dogActivitySelect.onchange = () => {
      const pet = getPetById(currentDogId);
      if (!pet) return;
      pet.activity = dogActivitySelect.value;
      savePets();
      updateDogActivityInfo(pet);
      calcDog(false);
    };

    dogMealsSelect.onchange = () => {
      const pet = getPetById(currentDogId);
      if (!pet) return;
      pet.meals = parseInt(dogMealsSelect.value) || 2;
      savePets();
      calcDog(false);
    };

    dogFoodKcalInput.onchange = () => {
      const pet = getPetById(currentDogId);
      if (!pet) return;
      const v = parseFloat(dogFoodKcalInput.value);
      pet.kcal = v > 0 ? v : null;
      savePets();
      calcDog(false);
    };

    dogCalcBtn.onclick = () => calcDog(true);

    function updateDogActivityInfo(pet) {
      const k = getK("dog", pet.activity);
      dogActivityInfo.textContent = `現在の係数: ${k}`;
    }

    function showDog() {
      const pet = getPetById(currentDogId);
      if (!pet) { dogDetailCard.style.display = "none"; return; }
      dogDetailCard.style.display = "block";
      dogTitle.textContent = `犬：${pet.name}`;
      dogActivitySelect.value = pet.activity;
      dogMealsSelect.value = String(pet.meals || 2);
      dogFoodKcalInput.value = pet.kcal || "";
      updateDogActivityInfo(pet);

      if (!pet.weights.length) {
        dogNoWeightMsg.style.display = "block";
        dogWeightList.innerHTML = "";
        dogChartWrap.style.display = "none";
        dogLatestWeightText.textContent = "最新の体重: -";
      } else {
        dogNoWeightMsg.style.display = "none";
        dogWeightList.innerHTML = "";
        pet.weights.forEach(w => {
          const li = document.createElement("li");
          li.textContent = `${formatDate(w.date)} : ${w.weight} kg`;
          dogWeightList.appendChild(li);
        });
        const last = latestWeight(pet);
        dogLatestWeightText.textContent = `最新の体重: ${last.weight} kg（${formatDate(last.date)}）`;
        drawChart(dogChart, pet.weights);
        dogChartWrap.style.display = "block";
      }
      calcDog(false);
    }

    function calcDog(showAlert) {
      const pet = getPetById(currentDogId);
      if (!pet) return;
      if (!pet.weights.length) {
        dogResultBox.style.display = "none";
        if (showAlert) alert("まず体重を記録してください。");
        return;
      }
      const last = latestWeight(pet);
      const w = last.weight;
      const k = getK("dog", pet.activity);
      const meals = pet.meals || 2;
      const kcalPer100 = pet.kcal || parseFloat(dogFoodKcalInput.value);
      if (!kcalPer100 || kcalPer100 <= 0) {
        dogResultBox.style.display = "none";
        if (showAlert) alert("フード100gあたりのカロリーを入力してください。");
        return;
      }
      const RER = 70 * Math.pow(w, 0.75);
      const DER = RER * k;
      const dailyKcal = DER;
      const dailyGram = dailyKcal / kcalPer100 * 100;
      const perMealGram = dailyGram / meals;

      dogRerSpan.textContent = roundInt(RER);
      dogDerSpan.textContent = roundInt(DER);
      dogDailyGramSpan.textContent = roundInt(dailyGram);
      dogPerMealGramSpan.textContent = roundInt(perMealGram);
      dogResultBox.style.display = "block";
    }

    // ---- 猫 ----
    const catListEl = document.getElementById("catList");
    const catNameInput = document.getElementById("catNameInput");
    const addCatBtn = document.getElementById("addCatBtn");
    const catDetailCard = document.getElementById("catDetailCard");
    const catTitle = document.getElementById("catTitle");
    const catWeightInput = document.getElementById("catWeightInput");
    const catAddWeightBtn = document.getElementById("catAddWeightBtn");
    const catLatestWeightText = document.getElementById("catLatestWeightText");
    const catActivitySelect = document.getElementById("catActivitySelect");
    const catActivityInfo = document.getElementById("catActivityInfo");
    const catMealsSelect = document.getElementById("catMealsSelect");
    const catFoodKcalInput = document.getElementById("catFoodKcalInput");
    const catCalcBtn = document.getElementById("catCalcBtn");
    const catResultBox = document.getElementById("catResultBox");
    const catRerSpan = document.getElementById("catRerSpan");
    const catDerSpan = document.getElementById("catDerSpan");
    const catDailyGramSpan = document.getElementById("catDailyGram");
    const catPerMealGramSpan = document.getElementById("catPerMealGram");
    const catNoWeightMsg = document.getElementById("catNoWeightMsg");
    const catWeightList = document.getElementById("catWeightList");
    const catChartWrap = document.getElementById("catChartWrap");
    const catChart = document.getElementById("catChart");

    let currentCatId = null;

    function renderCatList() {
      const cats = getPetsBySpecies("cat");
      catListEl.innerHTML = "";
      if (cats.length === 0) {
        const span = document.createElement("span");
        span.className = "small";
        span.textContent = "まだ登録されていません。";
        catListEl.appendChild(span);
        catDetailCard.style.display = "none";
        return;
      }
      cats.forEach(p => {
        const b = document.createElement("button");
        b.type = "button";
        b.className = "pet-chip" + (p.id === currentCatId ? " active" : "");
        b.textContent = p.name;
        b.onclick = () => {
          currentCatId = p.id;
          renderCatList();
          showCat();
        };
        catListEl.appendChild(b);
      });
    }

    addCatBtn.onclick = () => {
      const name = catNameInput.value.trim();
      if (!name) { alert("名前を入力してください。"); return; }
      const pet = {
        id: generateId(),
        name,
        species: "cat",
        activity: "neutered",
        meals: 2,
        kcal: null,
        weights: []
      };
      pets.push(pet);
      savePets();
      catNameInput.value = "";
      currentCatId = pet.id;
      renderCatList();
      showCat();
    };

    catAddWeightBtn.onclick = () => {
      const pet = getPetById(currentCatId);
      if (!pet) return;
      const w = parseFloat(catWeightInput.value);
      if (!w || w <= 0) { alert("体重を正しく入力してください。"); return; }
      pet.weights.push({ date: getToday(), weight: w });
      savePets();
      catWeightInput.value = "";
      showCat();
    };

    catActivitySelect.onchange = () => {
      const pet = getPetById(currentCatId);
      if (!pet) return;
      pet.activity = catActivitySelect.value;
      savePets();
      updateCatActivityInfo(pet);
      calcCat(false);
    };

    catMealsSelect.onchange = () => {
      const pet = getPetById(currentCatId);
      if (!pet) return;
      pet.meals = parseInt(catMealsSelect.value) || 2;
      savePets();
      calcCat(false);
    };

    catFoodKcalInput.onchange = () => {
      const pet = getPetById(currentCatId);
      if (!pet) return;
      const v = parseFloat(catFoodKcalInput.value);
      pet.kcal = v > 0 ? v : null;
      savePets();
      calcCat(false);
    };

    catCalcBtn.onclick = () => calcCat(true);

    function updateCatActivityInfo(pet) {
      const k = getK("cat", pet.activity);
      catActivityInfo.textContent = `現在の係数: ${k}`;
    }

    function showCat() {
      const pet = getPetById(currentCatId);
      if (!pet) { catDetailCard.style.display = "none"; return; }
      catDetailCard.style.display = "block";
      catTitle.textContent = `猫：${pet.name}`;
      catActivitySelect.value = pet.activity;
      catMealsSelect.value = String(pet.meals || 2);
      catFoodKcalInput.value = pet.kcal || "";
      updateCatActivityInfo(pet);

      if (!pet.weights.length) {
        catNoWeightMsg.style.display = "block";
        catWeightList.innerHTML = "";
        catChartWrap.style.display = "none";
        catLatestWeightText.textContent = "最新の体重: -";
      } else {
        catNoWeightMsg.style.display = "none";
        catWeightList.innerHTML = "";
        pet.weights.forEach(w => {
          const li = document.createElement("li");
          li.textContent = `${formatDate(w.date)} : ${w.weight} kg`;
          catWeightList.appendChild(li);
        });
        const last = latestWeight(pet);
        catLatestWeightText.textContent = `最新の体重: ${last.weight} kg（${formatDate(last.date)}）`;
        drawChart(catChart, pet.weights);
        catChartWrap.style.display = "block";
      }
      calcCat(false);
    }

    function calcCat(showAlert) {
      const pet = getPetById(currentCatId);
      if (!pet) return;
      if (!pet.weights.length) {
        catResultBox.style.display = "none";
        if (showAlert) alert("まず体重を記録してください。");
        return;
      }
      const last = latestWeight(pet);
      const w = last.weight;
      const k = getK("cat", pet.activity);
      const meals = pet.meals || 2;
      const kcalPer100 = pet.kcal || parseFloat(catFoodKcalInput.value);
      if (!kcalPer100 || kcalPer100 <= 0) {
        catResultBox.style.display = "none";
        if (showAlert) alert("フード100gあたりのカロリーを入力してください。");
        return;
      }
      const RER = 70 * Math.pow(w, 0.75);
      const DER = RER * k;
      const dailyKcal = DER;
      const dailyGram = dailyKcal / kcalPer100 * 100;
      const perMealGram = dailyGram / meals;

      catRerSpan.textContent = roundInt(RER);
      catDerSpan.textContent = roundInt(DER);
      catDailyGramSpan.textContent = roundInt(dailyGram);
      catPerMealGramSpan.textContent = roundInt(perMealGram);
      catResultBox.style.display = "block";
    }

    // グラフ
    function drawChart(svg, weights) {
      while (svg.firstChild) svg.removeChild(svg.firstChild);
      const w = svg.clientWidth || 300;
      const h = svg.clientHeight || 150;
      const pad = 24;
      const n = weights.length;
      if (!n) return;
      const ys = weights.map(x => x.weight);
      const minY = Math.min(...ys);
      const maxY = Math.max(...ys);
      const margin = (maxY - minY) * 0.2 || 0.2;
      const yMin = minY - margin;
      const yMax = maxY + margin;

      function xScale(i) {
        return pad + (w - pad * 2) * (i / Math.max(1, n - 1));
      }
      function yScale(val) {
        return h - pad - (h - pad * 2) * ((val - yMin) / (yMax - yMin));
      }

      const axisX = document.createElementNS("http://www.w3.org/2000/svg", "line");
      axisX.setAttribute("x1", pad);
      axisX.setAttribute("y1", h - pad);
      axisX.setAttribute("x2", w - pad);
      axisX.setAttribute("y2", h - pad);
      axisX.setAttribute("stroke", "#ccc");
      axisX.setAttribute("stroke-width", "1");
      svg.appendChild(axisX);

      const axisY = document.createElementNS("http://www.w3.org/2000/svg", "line");
      axisY.setAttribute("x1", pad);
      axisY.setAttribute("y1", pad);
      axisY.setAttribute("x2", pad);
      axisY.setAttribute("y2", h - pad);
      axisY.setAttribute("stroke", "#ccc");
      axisY.setAttribute("stroke-width", "1");
      svg.appendChild(axisY);

      const points = weights.map((d, i) => `${xScale(i)},${yScale(d.weight)}`).join(" ");
      const poly = document.createElementNS("http://www.w3.org/2000/svg", "polyline");
      poly.setAttribute("points", points);
      poly.setAttribute("fill", "none");
      poly.setAttribute("stroke", "#1976d2");
      poly.setAttribute("stroke-width", "2");
      svg.appendChild(poly);

      weights.forEach((d, i) => {
        const cx = xScale(i);
        const cy = yScale(d.weight);
        const c = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        c.setAttribute("cx", cx);
        c.setAttribute("cy", cy);
        c.setAttribute("r", 3.5);
        c.setAttribute("fill", "#1976d2");
        svg.appendChild(c);
      });
    }

    // 初期表示
    renderDogList();
    renderCatList();
    const firstDog = getPetsBySpecies("dog")[0];
    if (firstDog) { currentDogId = firstDog.id; showDog(); }
    const firstCat = getPetsBySpecies("cat")[0];
    if (firstCat) { currentCatId = firstCat.id; showCat(); }
  </script>
</body>
</html>
